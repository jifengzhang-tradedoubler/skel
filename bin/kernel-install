#!/bin/bash

if [ -z $1 ]; then
    echo "The first parameter should be the kernel version e.g. 2.6.29.3 and the source should reside in /usr/src/linux-\$1"
    exit 1
fi

if [ -f $2 ]; then
    echo "The second parameter should be the local version of the kernel e.g. '1' for the first local kernel of a certain official kernel version."
    exit 1
fi

cd /usr/src/linux-"$1"

cp -vp .config /boot/config-"$1-$2"
#cp -p .config /mnt/sda2/boot/config-"$1-$2"

cp -vp System.map /boot/System.map-"$1-$2"
#cp -p System.map /mnt/sda2/boot/System.map-"$1-$2"

cp -vp arch/i386/boot/bzImage /boot/vmlinuz-"$1-$2"
#cp -p arch/x86_64/boot/bzImage /mnt/sda2/boot/vmlinuz-"$1-$2"

echo creating initrd
mkinitramfs -v -k "$1" -o /boot/initrd.img-"$1-$2"
#cp /boot/initrd.img-"$1-$2" /mnt/sda2/boot

emacs -nw /boot/grub/menu.lst
#emacs -nw /mnt/sda2/boot/grub/menu.lst
