#!/bin/bash

BACKUP_SOURCE_DIR=/home/kjell/
BACKUP_ROOT=/mnt/raid/kjell/backup/home
BACKUP_TARGET_DIR=$BACKUP_ROOT/backup.0
BACKUP_PREV_DIR=$BACKUP_ROOT/backup.1
EXCLUDES=/home/kjell/.rsync_excludes

rm -rf $BACKUP_ROOT/backup.3
mv $BACKUP_ROOT/backup.2 $BACKUP_ROOT/backup.3
mv $BACKUP_PREV_DIR $BACKUP_ROOT/backup.2
mv $BACKUP_TARGET_DIR $BACKUP_PREV_DIR
#mkdir $BACKUP_TARGET_DIR

rsync --archive --one-file-system --hard-links --human-readable --inplace \
    --numeric-ids --delete --delete-excluded --exclude-from=$EXCLUDES \
    --link-dest=$BACKUP_PREV_DIR $BACKUP_SOURCE_DIR $BACKUP_TARGET_DIR
